// -*- mode:java; tab-width:2; c-basic-offset:2; intent-tabs-mode:nil; -*- ex: set tabstop=2 expandtab:

// Sun Almanac (SunAlmanac)
// Copyright (C) 2017-2018 Cedric Dufour <http://cedric.dufour.name>
//
// Sun Almanac (SunAlmanac) is free software:
// you can redistribute it and/or modify it under the terms of the GNU General
// Public License as published by the Free Software Foundation, Version 3.
//
// Sun Almanac (SunAlmanac) is distributed in the hope that it will be
// useful, but WITHOUT ANY WARRANTY; without even the implied warranty of
// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
//
// See the GNU General Public License for more details.
//
// SPDX-License-Identifier: GPL-3.0
// License-Filename: LICENSE/GPL-3.0.txt

using Toybox.Lang;
using Toybox.Time;
using Toybox.Time.Gregorian;

(:test)
module SA_Tests {
  
  function verifyTimeLT(_oLogger, _iEpochTimestamp, _iReference_year, _iReference_month, _iReference_day, _iReference_hour, _iReference_min) {
    // Components
    var oTime = new Time.Moment(_iEpochTimestamp);
    var oTimeInfo = Gregorian.info(oTime, Time.FORMAT_SHORT);
    var iVerify_year = oTimeInfo.year;
    var iVerify_month = oTimeInfo.month;
    var iVerify_day = oTimeInfo.day;
    var iVerify_hour = oTimeInfo.hour;
    var iVerify_min = oTimeInfo.min;
    // ... round minutes
    if(oTimeInfo.sec >= 30) {
      iVerify_min += 1;
      if(iVerify_min >= 60) {
        iVerify_min -= 60;
        iVerify_hour += 1;
        if(iVerify_hour >= 24) {
          iVerify_hour -= 24;
        }
      }
    }

    // Verify date
    if(iVerify_year != _iReference_year) {
      _oLogger.error(Lang.format("Date (year) mismatch! Got: $1$; Expected: *$2$*, $3$, $4$, $5$:$6$", [iVerify_year, _iReference_year, _iReference_month, _iReference_day, _iReference_hour, _iReference_min]));
      return -1;
    }
    if(iVerify_month != _iReference_month) {
      _oLogger.error(Lang.format("Date (month) mismatch! Got: $1$; Expected: $2$, *$3$*, $4$, $5$:$6$", [iVerify_month, _iReference_year, _iReference_month, _iReference_day, _iReference_hour, _iReference_min]));
      return -1;
    }
    if(iVerify_day != _iReference_day) {
      _oLogger.error(Lang.format("Date (day) mismatch! Got: $1$; Expected: $2$, $3$, *$4$*, $5$:$6$", [iVerify_day, _iReference_year, _iReference_month, _iReference_day, _iReference_hour, _iReference_min]));
      return -1;
    }

    // Verify time
    var iReference_minutes = 60*_iReference_hour + _iReference_min;
    var iVerify_minutes = 60*iVerify_hour + iVerify_min;
    var iDelta = (iVerify_minutes - iReference_minutes).abs();
    if(iDelta >= 90) {
      _oLogger.error(Lang.format("Time mismatch! Got: $1$:$2$; Expected: $3$, $4$, $5$, *$6$:$7$*", [iVerify_hour, iVerify_min, _iReference_year, _iReference_month, _iReference_day, _iReference_hour, _iReference_min]));
      return -1;
    }
    if(iDelta >= 30) {
      // allow 60 minutes shift due to DST no being properly handled by Gregorian.info()
      iDelta = (iDelta - 60).abs();
    }
    for(var i=0; i<=5; i++) {
      if(iDelta == i) {
        return i;
      }
    }
    _oLogger.error(Lang.format("Time mismatch (delta=$1$)! Got: $2$:$3$; Expected: $4$, $5$, $6$, *$7$:$8$*", [iDelta, iVerify_hour, iVerify_min, _iReference_year, _iReference_month, _iReference_day, _iReference_hour, _iReference_min]));
    return -1;
  }

  (:test)
    function unitTest_CH_VFRGuide_2017(_oLogger) {
    // Table: year, month, dawn, sunrise, sunset, dusk (Local Time)
    // Source: Switzerland Aeronautical Information Publications (AIP)
    //         VFR Guide, edition 170720, RAC 1-1, page 50-51
    var ALMANAC_DATA = [ [ 2017, 1, 1, 741, 816, 1652, 1727 ],
                         [ 2017, 1, 2, 741, 816, 1653, 1728 ],
                         [ 2017, 1, 3, 741, 816, 1654, 1729 ],
                         [ 2017, 1, 4, 741, 816, 1655, 1730 ],
                         [ 2017, 1, 5, 741, 816, 1656, 1731 ],
                         [ 2017, 1, 6, 740, 815, 1657, 1732 ],
                         [ 2017, 1, 7, 740, 815, 1658, 1733 ],
                         [ 2017, 1, 8, 740, 815, 1700, 1734 ],
                         [ 2017, 1, 9, 740, 814, 1701, 1735 ],
                         [ 2017, 1, 10, 739, 814, 1702, 1737 ],
                         [ 2017, 1, 11, 739, 814, 1703, 1738 ],
                         [ 2017, 1, 12, 739, 813, 1705, 1739 ],
                         [ 2017, 1, 13, 738, 813, 1706, 1740 ],
                         [ 2017, 1, 14, 738, 812, 1707, 1741 ],
                         [ 2017, 1, 15, 737, 811, 1708, 1743 ],
                         [ 2017, 1, 16, 737, 811, 1710, 1744 ],
                         [ 2017, 1, 17, 736, 810, 1711, 1745 ],
                         [ 2017, 1, 18, 735, 809, 1713, 1746 ],
                         [ 2017, 1, 19, 735, 808, 1714, 1748 ],
                         [ 2017, 1, 20, 734, 808, 1715, 1749 ],
                         [ 2017, 1, 21, 733, 807, 1717, 1750 ],
                         [ 2017, 1, 22, 732, 806, 1718, 1752 ],
                         [ 2017, 1, 23, 732, 805, 1720, 1753 ],
                         [ 2017, 1, 24, 731, 804, 1721, 1755 ],
                         [ 2017, 1, 25, 730, 803, 1723, 1756 ],
                         [ 2017, 1, 26, 729, 802, 1724, 1757 ],
                         [ 2017, 1, 27, 728, 801, 1726, 1759 ],
                         [ 2017, 1, 28, 727, 800, 1727, 1800 ],
                         [ 2017, 1, 29, 726, 759, 1729, 1802 ],
                         [ 2017, 1, 30, 725, 757, 1730, 1803 ],
                         [ 2017, 1, 31, 724, 756, 1732, 1804 ],
                         [ 2017, 2, 1, 722, 755, 1733, 1806 ],
                         [ 2017, 2, 2, 721, 754, 1735, 1807 ],
                         [ 2017, 2, 3, 720, 752, 1736, 1809 ],
                         [ 2017, 2, 4, 719, 751, 1738, 1810 ],
                         [ 2017, 2, 5, 718, 750, 1739, 1812 ],
                         [ 2017, 2, 6, 716, 748, 1741, 1813 ],
                         [ 2017, 2, 7, 715, 747, 1743, 1815 ],
                         [ 2017, 2, 8, 714, 745, 1744, 1816 ],
                         [ 2017, 2, 9, 712, 744, 1746, 1817 ],
                         [ 2017, 2, 10, 711, 742, 1747, 1819 ],
                         [ 2017, 2, 11, 709, 741, 1749, 1820 ],
                         [ 2017, 2, 12, 708, 739, 1750, 1822 ],
                         [ 2017, 2, 13, 706, 738, 1752, 1823 ],
                         [ 2017, 2, 14, 705, 736, 1753, 1825 ],
                         [ 2017, 2, 15, 703, 735, 1755, 1826 ],
                         [ 2017, 2, 16, 702, 733, 1756, 1828 ],
                         [ 2017, 2, 17, 700, 731, 1758, 1829 ],
                         [ 2017, 2, 18, 658, 730, 1759, 1831 ],
                         [ 2017, 2, 19, 657, 728, 1801, 1832 ],
                         [ 2017, 2, 20, 655, 726, 1802, 1833 ],
                         [ 2017, 2, 21, 654, 724, 1804, 1835 ],
                         [ 2017, 2, 22, 652, 723, 1805, 1836 ],
                         [ 2017, 2, 23, 650, 721, 1807, 1838 ],
                         [ 2017, 2, 24, 648, 719, 1808, 1839 ],
                         [ 2017, 2, 25, 647, 717, 1810, 1841 ],
                         [ 2017, 2, 26, 645, 716, 1811, 1842 ],
                         [ 2017, 2, 27, 643, 714, 1813, 1844 ],
                         [ 2017, 2, 28, 641, 712, 1814, 1845 ],
                         [ 2017, 3, 1, 640, 710, 1816, 1846 ],
                         [ 2017, 3, 2, 638, 708, 1817, 1848 ],
                         [ 2017, 3, 3, 636, 706, 1819, 1849 ],
                         [ 2017, 3, 4, 634, 704, 1820, 1851 ],
                         [ 2017, 3, 5, 632, 703, 1822, 1852 ],
                         [ 2017, 3, 6, 630, 701, 1823, 1854 ],
                         [ 2017, 3, 7, 628, 659, 1825, 1855 ],
                         [ 2017, 3, 8, 626, 657, 1826, 1856 ],
                         [ 2017, 3, 9, 625, 655, 1827, 1858 ],
                         [ 2017, 3, 10, 623, 653, 1829, 1859 ],
                         [ 2017, 3, 11, 621, 651, 1830, 1901 ],
                         [ 2017, 3, 12, 619, 649, 1832, 1902 ],
                         [ 2017, 3, 13, 617, 647, 1833, 1903 ],
                         [ 2017, 3, 14, 615, 645, 1835, 1905 ],
                         [ 2017, 3, 15, 613, 643, 1836, 1906 ],
                         [ 2017, 3, 16, 611, 641, 1837, 1908 ],
                         [ 2017, 3, 17, 609, 639, 1839, 1909 ],
                         [ 2017, 3, 18, 607, 637, 1840, 1911 ],
                         [ 2017, 3, 19, 605, 635, 1842, 1912 ],
                         [ 2017, 3, 20, 603, 633, 1843, 1913 ],
                         [ 2017, 3, 21, 601, 631, 1844, 1915 ],
                         [ 2017, 3, 22, 559, 629, 1846, 1916 ],
                         [ 2017, 3, 23, 557, 627, 1847, 1918 ],
                         [ 2017, 3, 24, 555, 625, 1849, 1919 ],
                         [ 2017, 3, 25, 553, 623, 1850, 1920 ],
                         [ 2017, 3, 26, 651, 721, 1951, 2022 ],
                         [ 2017, 3, 27, 649, 719, 1953, 2023 ],
                         [ 2017, 3, 28, 647, 717, 1954, 2025 ],
                         [ 2017, 3, 29, 645, 715, 1955, 2026 ],
                         [ 2017, 3, 30, 643, 713, 1957, 2028 ],
                         [ 2017, 3, 31, 641, 711, 1958, 2029 ],
                         [ 2017, 4, 1, 639, 709, 2000, 2030 ],
                         [ 2017, 4, 2, 637, 707, 2001, 2032 ],
                         [ 2017, 4, 3, 635, 705, 2002, 2033 ],
                         [ 2017, 4, 4, 633, 704, 2004, 2035 ],
                         [ 2017, 4, 5, 631, 702, 2005, 2036 ],
                         [ 2017, 4, 6, 629, 700, 2006, 2038 ],
                         [ 2017, 4, 7, 627, 658, 2008, 2039 ],
                         [ 2017, 4, 8, 625, 656, 2009, 2041 ],
                         [ 2017, 4, 9, 622, 654, 2011, 2042 ],
                         [ 2017, 4, 10, 620, 652, 2012, 2044 ],
                         [ 2017, 4, 11, 619, 650, 2013, 2045 ],
                         [ 2017, 4, 12, 617, 648, 2015, 2046 ],
                         [ 2017, 4, 13, 615, 646, 2016, 2048 ],
                         [ 2017, 4, 14, 613, 644, 2018, 2049 ],
                         [ 2017, 4, 15, 611, 643, 2019, 2051 ],
                         [ 2017, 4, 16, 609, 641, 2020, 2052 ],
                         [ 2017, 4, 17, 607, 639, 2022, 2054 ],
                         [ 2017, 4, 18, 605, 637, 2023, 2055 ],
                         [ 2017, 4, 19, 603, 635, 2024, 2057 ],
                         [ 2017, 4, 20, 601, 633, 2026, 2058 ],
                         [ 2017, 4, 21, 559, 632, 2027, 2100 ],
                         [ 2017, 4, 22, 557, 630, 2028, 2101 ],
                         [ 2017, 4, 23, 555, 628, 2030, 2103 ],
                         [ 2017, 4, 24, 553, 626, 2031, 2104 ],
                         [ 2017, 4, 25, 552, 625, 2033, 2106 ],
                         [ 2017, 4, 26, 550, 623, 2034, 2107 ],
                         [ 2017, 4, 27, 548, 621, 2035, 2109 ],
                         [ 2017, 4, 28, 546, 620, 2037, 2110 ],
                         [ 2017, 4, 29, 544, 618, 2038, 2112 ],
                         [ 2017, 4, 30, 543, 616, 2039, 2113 ],
                         [ 2017, 5, 1, 541, 615, 2041, 2115 ],
                         [ 2017, 5, 2, 539, 613, 2042, 2116 ],
                         [ 2017, 5, 3, 538, 612, 2043, 2118 ],
                         [ 2017, 5, 4, 536, 610, 2045, 2119 ],
                         [ 2017, 5, 5, 534, 609, 2046, 2121 ],
                         [ 2017, 5, 6, 533, 607, 2047, 2122 ],
                         [ 2017, 5, 7, 531, 606, 2049, 2124 ],
                         [ 2017, 5, 8, 529, 604, 2050, 2125 ],
                         [ 2017, 5, 9, 528, 603, 2051, 2127 ],
                         [ 2017, 5, 10, 526, 602, 2053, 2128 ],
                         [ 2017, 5, 11, 525, 600, 2054, 2129 ],
                         [ 2017, 5, 12, 523, 559, 2055, 2131 ],
                         [ 2017, 5, 13, 522, 558, 2056, 2132 ],
                         [ 2017, 5, 14, 520, 556, 2058, 2134 ],
                         [ 2017, 5, 15, 519, 555, 2059, 2135 ],
                         [ 2017, 5, 16, 518, 554, 2100, 2136 ],
                         [ 2017, 5, 17, 516, 553, 2101, 2138 ],
                         [ 2017, 5, 18, 515, 551, 2103, 2139 ],
                         [ 2017, 5, 19, 514, 550, 2104, 2140 ],
                         [ 2017, 5, 20, 513, 549, 2105, 2142 ],
                         [ 2017, 5, 21, 511, 548, 2106, 2143 ],
                         [ 2017, 5, 22, 510, 547, 2107, 2144 ],
                         [ 2017, 5, 23, 509, 546, 2108, 2146 ],
                         [ 2017, 5, 24, 508, 545, 2109, 2147 ],
                         [ 2017, 5, 25, 507, 545, 2110, 2148 ],
                         [ 2017, 5, 26, 506, 544, 2112, 2149 ],
                         [ 2017, 5, 27, 505, 543, 2113, 2151 ],
                         [ 2017, 5, 28, 504, 542, 2114, 2152 ],
                         [ 2017, 5, 29, 503, 541, 2115, 2153 ],
                         [ 2017, 5, 30, 502, 541, 2116, 2154 ],
                         [ 2017, 5, 31, 502, 540, 2117, 2155 ],
                         [ 2017, 6, 1, 501, 539, 2117, 2156 ],
                         [ 2017, 6, 2, 500, 539, 2118, 2157 ],
                         [ 2017, 6, 3, 459, 538, 2119, 2158 ],
                         [ 2017, 6, 4, 459, 538, 2120, 2159 ],
                         [ 2017, 6, 5, 458, 537, 2121, 2200 ],
                         [ 2017, 6, 6, 458, 537, 2122, 2201 ],
                         [ 2017, 6, 7, 457, 536, 2122, 2202 ],
                         [ 2017, 6, 8, 457, 536, 2123, 2202 ],
                         [ 2017, 6, 9, 456, 536, 2124, 2203 ],
                         [ 2017, 6, 10, 456, 535, 2124, 2204 ],
                         [ 2017, 6, 11, 456, 535, 2125, 2204 ],
                         [ 2017, 6, 12, 456, 535, 2125, 2205 ],
                         [ 2017, 6, 13, 455, 535, 2126, 2206 ],
                         [ 2017, 6, 14, 455, 535, 2126, 2206 ],
                         [ 2017, 6, 15, 455, 535, 2127, 2207 ],
                         [ 2017, 6, 16, 455, 535, 2127, 2207 ],
                         [ 2017, 6, 17, 455, 535, 2128, 2207 ],
                         [ 2017, 6, 18, 455, 535, 2128, 2208 ],
                         [ 2017, 6, 19, 455, 535, 2128, 2208 ],
                         [ 2017, 6, 20, 455, 535, 2129, 2208 ],
                         [ 2017, 6, 21, 456, 535, 2129, 2209 ],
                         [ 2017, 6, 22, 456, 536, 2129, 2209 ],
                         [ 2017, 6, 23, 456, 536, 2129, 2209 ],
                         [ 2017, 6, 24, 456, 536, 2129, 2209 ],
                         [ 2017, 6, 25, 457, 537, 2129, 2209 ],
                         [ 2017, 6, 26, 457, 537, 2129, 2209 ],
                         [ 2017, 6, 27, 458, 537, 2129, 2209 ],
                         [ 2017, 6, 28, 458, 538, 2129, 2209 ],
                         [ 2017, 6, 29, 459, 538, 2129, 2209 ],
                         [ 2017, 6, 30, 459, 539, 2129, 2208 ],
                         [ 2017, 7, 1, 500, 539, 2129, 2208 ],
                         [ 2017, 7, 2, 501, 540, 2128, 2208 ],
                         [ 2017, 7, 3, 501, 541, 2128, 2207 ],
                         [ 2017, 7, 4, 502, 541, 2128, 2207 ],
                         [ 2017, 7, 5, 503, 542, 2127, 2206 ],
                         [ 2017, 7, 6, 504, 543, 2127, 2206 ],
                         [ 2017, 7, 7, 505, 544, 2126, 2205 ],
                         [ 2017, 7, 8, 505, 544, 2126, 2205 ],
                         [ 2017, 7, 9, 506, 545, 2125, 2204 ],
                         [ 2017, 7, 10, 507, 546, 2125, 2203 ],
                         [ 2017, 7, 11, 508, 547, 2124, 2203 ],
                         [ 2017, 7, 12, 509, 548, 2123, 2202 ],
                         [ 2017, 7, 13, 510, 549, 2123, 2201 ],
                         [ 2017, 7, 14, 512, 550, 2122, 2200 ],
                         [ 2017, 7, 15, 513, 551, 2121, 2159 ],
                         [ 2017, 7, 16, 514, 552, 2120, 2158 ],
                         [ 2017, 7, 17, 515, 553, 2120, 2157 ],
                         [ 2017, 7, 18, 516, 554, 2119, 2156 ],
                         [ 2017, 7, 19, 517, 555, 2118, 2155 ],
                         [ 2017, 7, 20, 519, 556, 2117, 2154 ],
                         [ 2017, 7, 21, 520, 557, 2116, 2153 ],
                         [ 2017, 7, 22, 521, 558, 2115, 2152 ],
                         [ 2017, 7, 23, 522, 559, 2114, 2150 ],
                         [ 2017, 7, 24, 524, 600, 2113, 2149 ],
                         [ 2017, 7, 25, 525, 601, 2111, 2148 ],
                         [ 2017, 7, 26, 526, 603, 2110, 2146 ],
                         [ 2017, 7, 27, 528, 604, 2109, 2145 ],
                         [ 2017, 7, 28, 529, 605, 2108, 2144 ],
                         [ 2017, 7, 29, 530, 606, 2106, 2142 ],
                         [ 2017, 7, 30, 532, 607, 2105, 2141 ],
                         [ 2017, 7, 31, 533, 609, 2104, 2139 ],
                         [ 2017, 8, 1, 534, 610, 2103, 2138 ],
                         [ 2017, 8, 2, 536, 611, 2101, 2136 ],
                         [ 2017, 8, 3, 537, 612, 2100, 2135 ],
                         [ 2017, 8, 4, 539, 614, 2058, 2133 ],
                         [ 2017, 8, 5, 540, 615, 2057, 2132 ],
                         [ 2017, 8, 6, 541, 616, 2055, 2130 ],
                         [ 2017, 8, 7, 543, 617, 2054, 2128 ],
                         [ 2017, 8, 8, 544, 619, 2052, 2126 ],
                         [ 2017, 8, 9, 546, 620, 2051, 2125 ],
                         [ 2017, 8, 10, 547, 621, 2049, 2123 ],
                         [ 2017, 8, 11, 549, 622, 2048, 2121 ],
                         [ 2017, 8, 12, 550, 624, 2046, 2120 ],
                         [ 2017, 8, 13, 551, 625, 2044, 2118 ],
                         [ 2017, 8, 14, 553, 626, 2043, 2116 ],
                         [ 2017, 8, 15, 554, 628, 2041, 2114 ],
                         [ 2017, 8, 16, 556, 629, 2039, 2112 ],
                         [ 2017, 8, 17, 557, 630, 2037, 2110 ],
                         [ 2017, 8, 18, 558, 632, 2036, 2109 ],
                         [ 2017, 8, 19, 600, 633, 2034, 2107 ],
                         [ 2017, 8, 20, 601, 634, 2032, 2105 ],
                         [ 2017, 8, 21, 603, 635, 2030, 2103 ],
                         [ 2017, 8, 22, 604, 637, 2029, 2101 ],
                         [ 2017, 8, 23, 606, 638, 2027, 2059 ],
                         [ 2017, 8, 24, 607, 639, 2025, 2057 ],
                         [ 2017, 8, 25, 608, 641, 2023, 2055 ],
                         [ 2017, 8, 26, 610, 642, 2021, 2053 ],
                         [ 2017, 8, 27, 611, 643, 2019, 2051 ],
                         [ 2017, 8, 28, 613, 645, 2017, 2049 ],
                         [ 2017, 8, 29, 614, 646, 2016, 2047 ],
                         [ 2017, 8, 30, 615, 647, 2014, 2045 ],
                         [ 2017, 8, 31, 617, 648, 2012, 2043 ],
                         [ 2017, 9, 1, 618, 650, 2010, 2041 ],
                         [ 2017, 9, 2, 620, 651, 2008, 2039 ],
                         [ 2017, 9, 3, 621, 652, 2006, 2037 ],
                         [ 2017, 9, 4, 622, 654, 2004, 2035 ],
                         [ 2017, 9, 5, 624, 655, 2002, 2033 ],
                         [ 2017, 9, 6, 625, 656, 2000, 2031 ],
                         [ 2017, 9, 7, 626, 658, 1958, 2029 ],
                         [ 2017, 9, 8, 628, 659, 1956, 2027 ],
                         [ 2017, 9, 9, 629, 700, 1954, 2025 ],
                         [ 2017, 9, 10, 631, 701, 1952, 2023 ],
                         [ 2017, 9, 11, 632, 703, 1950, 2021 ],
                         [ 2017, 9, 12, 633, 704, 1948, 2019 ],
                         [ 2017, 9, 13, 635, 705, 1946, 2017 ],
                         [ 2017, 9, 14, 636, 707, 1944, 2015 ],
                         [ 2017, 9, 15, 637, 708, 1942, 2013 ],
                         [ 2017, 9, 16, 639, 709, 1940, 2010 ],
                         [ 2017, 9, 17, 640, 711, 1938, 2008 ],
                         [ 2017, 9, 18, 641, 712, 1936, 2006 ],
                         [ 2017, 9, 19, 643, 713, 1934, 2004 ],
                         [ 2017, 9, 20, 644, 714, 1932, 2002 ],
                         [ 2017, 9, 21, 645, 716, 1930, 2000 ],
                         [ 2017, 9, 22, 647, 717, 1928, 1958 ],
                         [ 2017, 9, 23, 648, 718, 1926, 1956 ],
                         [ 2017, 9, 24, 649, 720, 1924, 1954 ],
                         [ 2017, 9, 25, 651, 721, 1922, 1952 ],
                         [ 2017, 9, 26, 652, 722, 1920, 1950 ],
                         [ 2017, 9, 27, 653, 724, 1918, 1948 ],
                         [ 2017, 9, 28, 655, 725, 1916, 1946 ],
                         [ 2017, 9, 29, 656, 726, 1914, 1944 ],
                         [ 2017, 9, 30, 657, 728, 1912, 1942 ],
                         [ 2017, 10, 1, 659, 729, 1910, 1940 ],
                         [ 2017, 10, 2, 700, 730, 1908, 1938 ],
                         [ 2017, 10, 3, 701, 732, 1906, 1936 ],
                         [ 2017, 10, 4, 703, 733, 1904, 1934 ],
                         [ 2017, 10, 5, 704, 734, 1902, 1931 ],
                         [ 2017, 10, 6, 705, 736, 1900, 1930 ],
                         [ 2017, 10, 7, 707, 737, 1858, 1928 ],
                         [ 2017, 10, 8, 708, 739, 1856, 1927 ],
                         [ 2017, 10, 9, 709, 740, 1854, 1925 ],
                         [ 2017, 10, 10, 711, 741, 1852, 1923 ],
                         [ 2017, 10, 11, 712, 743, 1850, 1921 ],
                         [ 2017, 10, 12, 714, 744, 1849, 1919 ],
                         [ 2017, 10, 13, 715, 745, 1847, 1917 ],
                         [ 2017, 10, 14, 716, 747, 1845, 1915 ],
                         [ 2017, 10, 15, 718, 748, 1843, 1914 ],
                         [ 2017, 10, 16, 719, 750, 1841, 1912 ],
                         [ 2017, 10, 17, 720, 751, 1839, 1910 ],
                         [ 2017, 10, 18, 722, 753, 1837, 1908 ],
                         [ 2017, 10, 19, 723, 754, 1836, 1907 ],
                         [ 2017, 10, 20, 724, 755, 1834, 1905 ],
                         [ 2017, 10, 21, 726, 757, 1832, 1903 ],
                         [ 2017, 10, 22, 727, 758, 1830, 1901 ],
                         [ 2017, 10, 23, 729, 800, 1829, 1900 ],
                         [ 2017, 10, 24, 730, 801, 1827, 1858 ],
                         [ 2017, 10, 25, 731, 803, 1825, 1857 ],
                         [ 2017, 10, 26, 733, 804, 1824, 1855 ],
                         [ 2017, 10, 27, 734, 806, 1822, 1853 ],
                         [ 2017, 10, 28, 735, 807, 1820, 1852 ],
                         [ 2017, 10, 29, 637, 708, 1719, 1750 ],
                         [ 2017, 10, 30, 638, 710, 1717, 1749 ],
                         [ 2017, 10, 31, 640, 711, 1716, 1747 ],
                         [ 2017, 11, 1, 641, 713, 1714, 1746 ],
                         [ 2017, 11, 2, 642, 714, 1713, 1745 ],
                         [ 2017, 11, 3, 644, 716, 1711, 1743 ],
                         [ 2017, 11, 4, 645, 717, 1710, 1742 ],
                         [ 2017, 11, 5, 647, 719, 1708, 1740 ],
                         [ 2017, 11, 6, 648, 720, 1707, 1739 ],
                         [ 2017, 11, 7, 649, 722, 1706, 1738 ],
                         [ 2017, 11, 8, 651, 723, 1704, 1737 ],
                         [ 2017, 11, 9, 652, 725, 1703, 1735 ],
                         [ 2017, 11, 10, 654, 726, 1702, 1734 ],
                         [ 2017, 11, 11, 655, 728, 1700, 1733 ],
                         [ 2017, 11, 12, 656, 729, 1659, 1732 ],
                         [ 2017, 11, 13, 658, 731, 1658, 1731 ],
                         [ 2017, 11, 14, 659, 732, 1657, 1730 ],
                         [ 2017, 11, 15, 700, 734, 1656, 1729 ],
                         [ 2017, 11, 16, 702, 735, 1655, 1728 ],
                         [ 2017, 11, 17, 703, 736, 1654, 1727 ],
                         [ 2017, 11, 18, 704, 738, 1653, 1726 ],
                         [ 2017, 11, 19, 706, 739, 1652, 1725 ],
                         [ 2017, 11, 20, 707, 741, 1651, 1724 ],
                         [ 2017, 11, 21, 708, 742, 1650, 1724 ],
                         [ 2017, 11, 22, 710, 743, 1649, 1723 ],
                         [ 2017, 11, 23, 711, 745, 1648, 1722 ],
                         [ 2017, 11, 24, 712, 746, 1647, 1721 ],
                         [ 2017, 11, 25, 713, 748, 1647, 1721 ],
                         [ 2017, 11, 26, 715, 749, 1646, 1720 ],
                         [ 2017, 11, 27, 716, 750, 1645, 1720 ],
                         [ 2017, 11, 28, 717, 751, 1645, 1719 ],
                         [ 2017, 11, 29, 718, 753, 1644, 1719 ],
                         [ 2017, 11, 30, 719, 754, 1644, 1718 ],
                         [ 2017, 12, 1, 720, 755, 1643, 1718 ],
                         [ 2017, 12, 2, 722, 756, 1643, 1718 ],
                         [ 2017, 12, 3, 723, 757, 1643, 1717 ],
                         [ 2017, 12, 4, 724, 759, 1642, 1717 ],
                         [ 2017, 12, 5, 725, 800, 1642, 1717 ],
                         [ 2017, 12, 6, 726, 801, 1642, 1717 ],
                         [ 2017, 12, 7, 727, 802, 1641, 1717 ],
                         [ 2017, 12, 8, 728, 803, 1641, 1716 ],
                         [ 2017, 12, 9, 729, 804, 1641, 1716 ],
                         [ 2017, 12, 10, 730, 805, 1641, 1716 ],
                         [ 2017, 12, 11, 731, 806, 1641, 1716 ],
                         [ 2017, 12, 12, 731, 807, 1641, 1717 ],
                         [ 2017, 12, 13, 732, 807, 1641, 1717 ],
                         [ 2017, 12, 14, 733, 808, 1642, 1717 ],
                         [ 2017, 12, 15, 734, 809, 1642, 1717 ],
                         [ 2017, 12, 16, 734, 810, 1642, 1717 ],
                         [ 2017, 12, 17, 735, 811, 1642, 1718 ],
                         [ 2017, 12, 18, 736, 811, 1643, 1718 ],
                         [ 2017, 12, 19, 736, 812, 1643, 1718 ],
                         [ 2017, 12, 20, 737, 812, 1643, 1719 ],
                         [ 2017, 12, 21, 737, 813, 1644, 1719 ],
                         [ 2017, 12, 22, 738, 813, 1644, 1720 ],
                         [ 2017, 12, 23, 738, 814, 1645, 1720 ],
                         [ 2017, 12, 24, 739, 814, 1646, 1721 ],
                         [ 2017, 12, 25, 739, 815, 1646, 1722 ],
                         [ 2017, 12, 26, 740, 815, 1647, 1722 ],
                         [ 2017, 12, 27, 740, 815, 1648, 1723 ],
                         [ 2017, 12, 28, 740, 815, 1648, 1724 ],
                         [ 2017, 12, 29, 740, 816, 1649, 1725 ],
                         [ 2017, 12, 30, 740, 816, 1650, 1725 ],
                         [ 2017, 12, 31, 741, 816, 1651, 1726 ] ];

    // Sun Almanac computation object
    var oAlmanac = new SA_Almanac();
    oAlmanac.setLocation("CH/Bern", 46.9524055555556d, 7.43958333333333d, 0.0f);

    // Loop through reference data
    var aiError = [0, 0, 0, 0, 0, 0, 0];  // Time difference: error, 0, 1, 2, 3, 4, 5 minutes
    for(var i=0; i<ALMANAC_DATA.size(); i++) {
      var iReference_year = ALMANAC_DATA[i][0];
      var iReference_month = ALMANAC_DATA[i][1];
      var iReference_day = ALMANAC_DATA[i][2];
      var iReference_dawn = ALMANAC_DATA[i][3];
      var iReference_sunrise = ALMANAC_DATA[i][4];
      var iReference_sunset = ALMANAC_DATA[i][5];
      var iReference_dusk = ALMANAC_DATA[i][6];
      
      // Compute almanac data
      var iEpochDate = Gregorian.moment({ :year => iReference_year, :month => iReference_month, :day => iReference_day }).value();
      oAlmanac.compute(iEpochDate, null, true);
    
      // Unit tests
      var iDelta;
      var iReference_hour;
      var iReference_min;
      // ... civil dawn
      iReference_min = iReference_dawn % 100;
      iReference_hour = (iReference_dawn - iReference_min)/100;
      iDelta = SA_Tests.verifyTimeLT(_oLogger, oAlmanac.iEpochCivilDawn, iReference_year, iReference_month, iReference_day, iReference_hour, iReference_min);
      aiError[iDelta+1] += 1;
      // ... sunrise
      iReference_min = iReference_sunrise % 100;
      iReference_hour = (iReference_sunrise - iReference_min)/100;
      iDelta = SA_Tests.verifyTimeLT(_oLogger, oAlmanac.iEpochSunrise, iReference_year, iReference_month, iReference_day, iReference_hour, iReference_min);
      aiError[iDelta+1] += 1;
      // ... sunset
      iReference_min = iReference_sunset % 100;
      iReference_hour = (iReference_sunset - iReference_min)/100;
      iDelta = SA_Tests.verifyTimeLT(_oLogger, oAlmanac.iEpochSunset, iReference_year, iReference_month, iReference_day, iReference_hour, iReference_min);
      aiError[iDelta+1] += 1;
      // ... civil dusk
      iReference_min = iReference_dusk % 100;
      iReference_hour = (iReference_dusk - iReference_min)/100;
      iDelta = SA_Tests.verifyTimeLT(_oLogger, oAlmanac.iEpochCivilDusk, iReference_year, iReference_month, iReference_day, iReference_hour, iReference_min);
      aiError[iDelta+1] += 1;
    }

    // Statistics
    _oLogger.debug("STATISTICS");
    for(var i=0; i<=5; i++) {
      _oLogger.debug(Lang.format("Delta=$1$: $2$", [i, aiError[i+1]]));
    }
    if(aiError[0] > 0) {
      _oLogger.error(Lang.format("Delta>5: $1$", [aiError[0]]));
      return false;
    }
    return true;
  }

  (:test)
  function unitTest_CH_VFRGuide_2018(_oLogger) {
    // Table: year, month, dawn, sunrise, sunset, dusk (Local Time)
    // Source: Switzerland Aeronautical Information Publications (AIP)
    //         VFR Guide, edition 171012, RAC 1-1, page 50-51
    var ALMANAC_DATA = [ [ 2018, 1, 1, 741, 816, 1652, 1727 ],
                         [ 2018, 1, 2, 741, 816, 1653, 1728 ],
                         [ 2018, 1, 3, 741, 816, 1654, 1729 ],
                         [ 2018, 1, 4, 741, 816, 1655, 1730 ],
                         [ 2018, 1, 5, 741, 816, 1656, 1731 ],
                         [ 2018, 1, 6, 740, 815, 1657, 1732 ],
                         [ 2018, 1, 7, 740, 815, 1658, 1733 ],
                         [ 2018, 1, 8, 740, 815, 1659, 1734 ],
                         [ 2018, 1, 9, 740, 814, 1701, 1735 ],
                         [ 2018, 1, 10, 739, 814, 1702, 1736 ],
                         [ 2018, 1, 11, 739, 814, 1703, 1737 ],
                         [ 2018, 1, 12, 739, 813, 1704, 1739 ],
                         [ 2018, 1, 13, 738, 813, 1705, 1740 ],
                         [ 2018, 1, 14, 738, 812, 1707, 1741 ],
                         [ 2018, 1, 15, 737, 812, 1708, 1742 ],
                         [ 2018, 1, 16, 737, 811, 1709, 1744 ],
                         [ 2018, 1, 17, 736, 810, 1711, 1745 ],
                         [ 2018, 1, 18, 736, 809, 1712, 1746 ],
                         [ 2018, 1, 19, 735, 809, 1714, 1748 ],
                         [ 2018, 1, 20, 734, 808, 1715, 1749 ],
                         [ 2018, 1, 21, 733, 807, 1717, 1750 ],
                         [ 2018, 1, 22, 733, 806, 1718, 1751 ],
                         [ 2018, 1, 23, 732, 805, 1719, 1753 ],
                         [ 2018, 1, 24, 731, 804, 1721, 1754 ],
                         [ 2018, 1, 25, 730, 803, 1722, 1756 ],
                         [ 2018, 1, 26, 729, 802, 1724, 1757 ],
                         [ 2018, 1, 27, 728, 801, 1725, 1758 ],
                         [ 2018, 1, 28, 727, 800, 1727, 1800 ],
                         [ 2018, 1, 29, 726, 759, 1728, 1801 ],
                         [ 2018, 1, 30, 725, 758, 1730, 1803 ],
                         [ 2018, 1, 31, 724, 757, 1731, 1804 ],
                         [ 2018, 2, 1, 723, 755, 1733, 1805 ],
                         [ 2018, 2, 2, 722, 754, 1734, 1807 ],
                         [ 2018, 2, 3, 720, 753, 1736, 1808 ],
                         [ 2018, 2, 4, 719, 751, 1737, 1810 ],
                         [ 2018, 2, 5, 718, 750, 1739, 1811 ],
                         [ 2018, 2, 6, 717, 749, 1741, 1813 ],
                         [ 2018, 2, 7, 715, 747, 1742, 1814 ],
                         [ 2018, 2, 8, 714, 746, 1744, 1816 ],
                         [ 2018, 2, 9, 712, 744, 1745, 1817 ],
                         [ 2018, 2, 10, 711, 743, 1747, 1819 ],
                         [ 2018, 2, 11, 710, 741, 1748, 1820 ],
                         [ 2018, 2, 12, 708, 740, 1750, 1821 ],
                         [ 2018, 2, 13, 707, 738, 1751, 1823 ],
                         [ 2018, 2, 14, 705, 737, 1753, 1824 ],
                         [ 2018, 2, 15, 704, 735, 1754, 1826 ],
                         [ 2018, 2, 16, 702, 733, 1756, 1827 ],
                         [ 2018, 2, 17, 700, 732, 1758, 1829 ],
                         [ 2018, 2, 18, 659, 730, 1759, 1830 ],
                         [ 2018, 2, 19, 657, 728, 1801, 1832 ],
                         [ 2018, 2, 20, 656, 727, 1802, 1833 ],
                         [ 2018, 2, 21, 654, 725, 1804, 1835 ],
                         [ 2018, 2, 22, 652, 723, 1805, 1836 ],
                         [ 2018, 2, 23, 651, 721, 1807, 1837 ],
                         [ 2018, 2, 24, 649, 720, 1808, 1839 ],
                         [ 2018, 2, 25, 647, 718, 1810, 1840 ],
                         [ 2018, 2, 26, 645, 716, 1811, 1842 ],
                         [ 2018, 2, 27, 644, 714, 1813, 1843 ],
                         [ 2018, 2, 28, 642, 712, 1814, 1845 ],
                         [ 2018, 3, 1, 640, 710, 1815, 1846 ],
                         [ 2018, 3, 2, 638, 709, 1817, 1847 ],
                         [ 2018, 3, 3, 636, 707, 1818, 1849 ],
                         [ 2018, 3, 4, 634, 705, 1820, 1850 ],
                         [ 2018, 3, 5, 633, 703, 1821, 1852 ],
                         [ 2018, 3, 6, 631, 701, 1823, 1853 ],
                         [ 2018, 3, 7, 629, 659, 1824, 1855 ],
                         [ 2018, 3, 8, 627, 657, 1826, 1856 ],
                         [ 2018, 3, 9, 625, 655, 1827, 1857 ],
                         [ 2018, 3, 10, 623, 653, 1829, 1859 ],
                         [ 2018, 3, 11, 621, 651, 1830, 1900 ],
                         [ 2018, 3, 12, 619, 649, 1831, 1902 ],
                         [ 2018, 3, 13, 617, 648, 1833, 1903 ],
                         [ 2018, 3, 14, 615, 646, 1834, 1905 ],
                         [ 2018, 3, 15, 613, 644, 1836, 1906 ],
                         [ 2018, 3, 16, 611, 642, 1837, 1907 ],
                         [ 2018, 3, 17, 609, 640, 1838, 1909 ],
                         [ 2018, 3, 18, 607, 638, 1840, 1910 ],
                         [ 2018, 3, 19, 605, 636, 1841, 1912 ],
                         [ 2018, 3, 20, 603, 634, 1843, 1913 ],
                         [ 2018, 3, 21, 601, 632, 1844, 1914 ],
                         [ 2018, 3, 22, 559, 630, 1845, 1916 ],
                         [ 2018, 3, 23, 557, 628, 1847, 1917 ],
                         [ 2018, 3, 24, 555, 626, 1848, 1919 ],
                         [ 2018, 3, 25, 653, 724, 1950, 2020 ],
                         [ 2018, 3, 26, 651, 722, 1951, 2022 ],
                         [ 2018, 3, 27, 649, 720, 1952, 2023 ],
                         [ 2018, 3, 28, 647, 718, 1954, 2024 ],
                         [ 2018, 3, 29, 645, 716, 1955, 2026 ],
                         [ 2018, 3, 30, 643, 714, 1957, 2027 ],
                         [ 2018, 3, 31, 641, 712, 1958, 2029 ],
                         [ 2018, 4, 1, 639, 710, 1959, 2030 ],
                         [ 2018, 4, 2, 637, 708, 2001, 2032 ],
                         [ 2018, 4, 3, 635, 706, 2002, 2033 ],
                         [ 2018, 4, 4, 633, 704, 2003, 2034 ],
                         [ 2018, 4, 5, 631, 702, 2005, 2036 ],
                         [ 2018, 4, 6, 629, 700, 2006, 2037 ],
                         [ 2018, 4, 7, 627, 658, 2008, 2039 ],
                         [ 2018, 4, 8, 625, 656, 2009, 2040 ],
                         [ 2018, 4, 9, 623, 654, 2010, 2042 ],
                         [ 2018, 4, 10, 621, 652, 2012, 2043 ],
                         [ 2018, 4, 11, 619, 650, 2013, 2045 ],
                         [ 2018, 4, 12, 617, 649, 2014, 2046 ],
                         [ 2018, 4, 13, 615, 647, 2016, 2048 ],
                         [ 2018, 4, 14, 613, 645, 2017, 2049 ],
                         [ 2018, 4, 15, 611, 643, 2019, 2050 ],
                         [ 2018, 4, 16, 609, 641, 2020, 2052 ],
                         [ 2018, 4, 17, 607, 639, 2021, 2053 ],
                         [ 2018, 4, 18, 605, 637, 2023, 2055 ],
                         [ 2018, 4, 19, 603, 636, 2024, 2056 ],
                         [ 2018, 4, 20, 601, 634, 2025, 2058 ],
                         [ 2018, 4, 21, 600, 632, 2027, 2059 ],
                         [ 2018, 4, 22, 558, 630, 2028, 2101 ],
                         [ 2018, 4, 23, 556, 629, 2030, 2102 ],
                         [ 2018, 4, 24, 554, 627, 2031, 2104 ],
                         [ 2018, 4, 25, 552, 625, 2032, 2105 ],
                         [ 2018, 4, 26, 550, 623, 2034, 2107 ],
                         [ 2018, 4, 27, 548, 622, 2035, 2108 ],
                         [ 2018, 4, 28, 547, 620, 2036, 2110 ],
                         [ 2018, 4, 29, 545, 618, 2038, 2111 ],
                         [ 2018, 4, 30, 543, 617, 2039, 2113 ],
                         [ 2018, 5, 1, 541, 615, 2040, 2114 ],
                         [ 2018, 5, 2, 540, 614, 2042, 2116 ],
                         [ 2018, 5, 3, 538, 612, 2043, 2117 ],
                         [ 2018, 5, 4, 536, 610, 2044, 2119 ],
                         [ 2018, 5, 5, 535, 609, 2046, 2120 ],
                         [ 2018, 5, 6, 533, 607, 2047, 2122 ],
                         [ 2018, 5, 7, 531, 606, 2048, 2123 ],
                         [ 2018, 5, 8, 530, 605, 2050, 2125 ],
                         [ 2018, 5, 9, 528, 603, 2051, 2126 ],
                         [ 2018, 5, 10, 527, 602, 2052, 2128 ],
                         [ 2018, 5, 11, 525, 600, 2054, 2129 ],
                         [ 2018, 5, 12, 524, 559, 2055, 2130 ],
                         [ 2018, 5, 13, 522, 558, 2056, 2132 ],
                         [ 2018, 5, 14, 521, 557, 2057, 2133 ],
                         [ 2018, 5, 15, 519, 555, 2059, 2135 ],
                         [ 2018, 5, 16, 518, 554, 2100, 2136 ],
                         [ 2018, 5, 17, 517, 553, 2101, 2137 ],
                         [ 2018, 5, 18, 515, 552, 2102, 2139 ],
                         [ 2018, 5, 19, 514, 551, 2104, 2140 ],
                         [ 2018, 5, 20, 513, 550, 2105, 2142 ],
                         [ 2018, 5, 21, 512, 549, 2106, 2143 ],
                         [ 2018, 5, 22, 511, 548, 2107, 2144 ],
                         [ 2018, 5, 23, 509, 547, 2108, 2145 ],
                         [ 2018, 5, 24, 508, 546, 2109, 2147 ],
                         [ 2018, 5, 25, 507, 545, 2110, 2148 ],
                         [ 2018, 5, 26, 506, 544, 2111, 2149 ],
                         [ 2018, 5, 27, 505, 543, 2112, 2150 ],
                         [ 2018, 5, 28, 504, 542, 2113, 2151 ],
                         [ 2018, 5, 29, 503, 541, 2114, 2153 ],
                         [ 2018, 5, 30, 503, 541, 2115, 2154 ],
                         [ 2018, 5, 31, 502, 540, 2116, 2155 ],
                         [ 2018, 6, 1, 501, 539, 2117, 2156 ],
                         [ 2018, 6, 2, 500, 539, 2118, 2157 ],
                         [ 2018, 6, 3, 500, 538, 2119, 2158 ],
                         [ 2018, 6, 4, 459, 538, 2120, 2159 ],
                         [ 2018, 6, 5, 458, 537, 2121, 2200 ],
                         [ 2018, 6, 6, 458, 537, 2121, 2200 ],
                         [ 2018, 6, 7, 457, 536, 2122, 2201 ],
                         [ 2018, 6, 8, 457, 536, 2123, 2202 ],
                         [ 2018, 6, 9, 457, 536, 2123, 2203 ],
                         [ 2018, 6, 10, 456, 535, 2124, 2204 ],
                         [ 2018, 6, 11, 456, 535, 2125, 2204 ],
                         [ 2018, 6, 12, 456, 535, 2125, 2205 ],
                         [ 2018, 6, 13, 455, 535, 2126, 2205 ],
                         [ 2018, 6, 14, 455, 535, 2126, 2206 ],
                         [ 2018, 6, 15, 455, 535, 2127, 2207 ],
                         [ 2018, 6, 16, 455, 535, 2127, 2207 ],
                         [ 2018, 6, 17, 455, 535, 2128, 2207 ],
                         [ 2018, 6, 18, 455, 535, 2128, 2208 ],
                         [ 2018, 6, 19, 455, 535, 2128, 2208 ],
                         [ 2018, 6, 20, 455, 535, 2129, 2208 ],
                         [ 2018, 6, 21, 455, 535, 2129, 2209 ],
                         [ 2018, 6, 22, 456, 536, 2129, 2209 ],
                         [ 2018, 6, 23, 456, 536, 2129, 2209 ],
                         [ 2018, 6, 24, 456, 536, 2129, 2209 ],
                         [ 2018, 6, 25, 457, 536, 2129, 2209 ],
                         [ 2018, 6, 26, 457, 537, 2129, 2209 ],
                         [ 2018, 6, 27, 458, 537, 2129, 2209 ],
                         [ 2018, 6, 28, 458, 538, 2129, 2209 ],
                         [ 2018, 6, 29, 459, 538, 2129, 2209 ],
                         [ 2018, 6, 30, 459, 539, 2129, 2208 ],
                         [ 2018, 7, 1, 500, 539, 2129, 2208 ],
                         [ 2018, 7, 2, 500, 540, 2128, 2208 ],
                         [ 2018, 7, 3, 501, 541, 2128, 2207 ],
                         [ 2018, 7, 4, 502, 541, 2128, 2207 ],
                         [ 2018, 7, 5, 503, 542, 2127, 2206 ],
                         [ 2018, 7, 6, 504, 543, 2127, 2206 ],
                         [ 2018, 7, 7, 504, 543, 2127, 2205 ],
                         [ 2018, 7, 8, 505, 544, 2126, 2205 ],
                         [ 2018, 7, 9, 506, 545, 2126, 2204 ],
                         [ 2018, 7, 10, 507, 546, 2125, 2204 ],
                         [ 2018, 7, 11, 508, 547, 2124, 2203 ],
                         [ 2018, 7, 12, 509, 548, 2124, 2202 ],
                         [ 2018, 7, 13, 510, 549, 2123, 2201 ],
                         [ 2018, 7, 14, 511, 549, 2122, 2200 ],
                         [ 2018, 7, 15, 512, 550, 2121, 2159 ],
                         [ 2018, 7, 16, 514, 551, 2121, 2158 ],
                         [ 2018, 7, 17, 515, 552, 2120, 2157 ],
                         [ 2018, 7, 18, 516, 553, 2119, 2156 ],
                         [ 2018, 7, 19, 517, 554, 2118, 2155 ],
                         [ 2018, 7, 20, 518, 556, 2117, 2154 ],
                         [ 2018, 7, 21, 520, 557, 2116, 2153 ],
                         [ 2018, 7, 22, 521, 558, 2115, 2152 ],
                         [ 2018, 7, 23, 522, 559, 2114, 2151 ],
                         [ 2018, 7, 24, 523, 600, 2113, 2149 ],
                         [ 2018, 7, 25, 525, 601, 2112, 2148 ],
                         [ 2018, 7, 26, 526, 602, 2111, 2147 ],
                         [ 2018, 7, 27, 527, 604, 2109, 2145 ],
                         [ 2018, 7, 28, 529, 605, 2108, 2144 ],
                         [ 2018, 7, 29, 530, 606, 2107, 2143 ],
                         [ 2018, 7, 30, 531, 607, 2106, 2141 ],
                         [ 2018, 7, 31, 533, 608, 2104, 2140 ],
                         [ 2018, 8, 1, 534, 609, 2103, 2138 ],
                         [ 2018, 8, 2, 535, 611, 2101, 2137 ],
                         [ 2018, 8, 3, 537, 612, 2100, 2135 ],
                         [ 2018, 8, 4, 538, 613, 2059, 2134 ],
                         [ 2018, 8, 5, 540, 614, 2057, 2132 ],
                         [ 2018, 8, 6, 541, 616, 2056, 2130 ],
                         [ 2018, 8, 7, 542, 617, 2054, 2129 ],
                         [ 2018, 8, 8, 544, 618, 2053, 2127 ],
                         [ 2018, 8, 9, 545, 620, 2051, 2125 ],
                         [ 2018, 8, 10, 547, 621, 2050, 2123 ],
                         [ 2018, 8, 11, 548, 622, 2048, 2122 ],
                         [ 2018, 8, 12, 550, 623, 2046, 2120 ],
                         [ 2018, 8, 13, 551, 625, 2045, 2118 ],
                         [ 2018, 8, 14, 552, 626, 2043, 2116 ],
                         [ 2018, 8, 15, 554, 627, 2041, 2115 ],
                         [ 2018, 8, 16, 555, 629, 2040, 2113 ],
                         [ 2018, 8, 17, 557, 630, 2038, 2111 ],
                         [ 2018, 8, 18, 558, 631, 2036, 2109 ],
                         [ 2018, 8, 19, 600, 633, 2034, 2107 ],
                         [ 2018, 8, 20, 601, 634, 2033, 2105 ],
                         [ 2018, 8, 21, 602, 635, 2031, 2103 ],
                         [ 2018, 8, 22, 604, 636, 2029, 2101 ],
                         [ 2018, 8, 23, 605, 638, 2027, 2100 ],
                         [ 2018, 8, 24, 607, 639, 2025, 2058 ],
                         [ 2018, 8, 25, 608, 640, 2023, 2056 ],
                         [ 2018, 8, 26, 609, 642, 2022, 2054 ],
                         [ 2018, 8, 27, 611, 643, 2020, 2052 ],
                         [ 2018, 8, 28, 612, 644, 2018, 2050 ],
                         [ 2018, 8, 29, 614, 646, 2016, 2048 ],
                         [ 2018, 8, 30, 615, 647, 2014, 2046 ],
                         [ 2018, 8, 31, 616, 648, 2012, 2044 ],
                         [ 2018, 9, 1, 618, 649, 2010, 2042 ],
                         [ 2018, 9, 2, 619, 651, 2008, 2040 ],
                         [ 2018, 9, 3, 621, 652, 2006, 2038 ],
                         [ 2018, 9, 4, 622, 653, 2004, 2036 ],
                         [ 2018, 9, 5, 623, 655, 2002, 2034 ],
                         [ 2018, 9, 6, 625, 656, 2000, 2031 ],
                         [ 2018, 9, 7, 626, 657, 1958, 2029 ],
                         [ 2018, 9, 8, 627, 658, 1956, 2027 ],
                         [ 2018, 9, 9, 629, 700, 1954, 2025 ],
                         [ 2018, 9, 10, 630, 701, 1952, 2023 ],
                         [ 2018, 9, 11, 632, 702, 1950, 2021 ],
                         [ 2018, 9, 12, 633, 704, 1949, 2019 ],
                         [ 2018, 9, 13, 634, 705, 1947, 2017 ],
                         [ 2018, 9, 14, 636, 706, 1945, 2015 ],
                         [ 2018, 9, 15, 637, 708, 1942, 2013 ],
                         [ 2018, 9, 16, 638, 709, 1940, 2011 ],
                         [ 2018, 9, 17, 640, 710, 1938, 2009 ],
                         [ 2018, 9, 18, 641, 712, 1936, 2007 ],
                         [ 2018, 9, 19, 642, 713, 1934, 2005 ],
                         [ 2018, 9, 20, 644, 714, 1932, 2003 ],
                         [ 2018, 9, 21, 645, 715, 1930, 2001 ],
                         [ 2018, 9, 22, 646, 717, 1928, 1959 ],
                         [ 2018, 9, 23, 648, 718, 1926, 1957 ],
                         [ 2018, 9, 24, 649, 719, 1924, 1955 ],
                         [ 2018, 9, 25, 650, 721, 1922, 1953 ],
                         [ 2018, 9, 26, 652, 722, 1920, 1951 ],
                         [ 2018, 9, 27, 653, 723, 1918, 1949 ],
                         [ 2018, 9, 28, 654, 725, 1916, 1947 ],
                         [ 2018, 9, 29, 656, 726, 1914, 1945 ],
                         [ 2018, 9, 30, 657, 727, 1912, 1943 ],
                         [ 2018, 10, 1, 658, 729, 1910, 1941 ],
                         [ 2018, 10, 2, 700, 730, 1908, 1939 ],
                         [ 2018, 10, 3, 701, 731, 1906, 1937 ],
                         [ 2018, 10, 4, 702, 733, 1904, 1935 ],
                         [ 2018, 10, 5, 704, 734, 1902, 1933 ],
                         [ 2018, 10, 6, 705, 735, 1901, 1931 ],
                         [ 2018, 10, 7, 706, 737, 1859, 1929 ],
                         [ 2018, 10, 8, 708, 738, 1857, 1927 ],
                         [ 2018, 10, 9, 709, 740, 1855, 1925 ],
                         [ 2018, 10, 10, 710, 741, 1853, 1923 ],
                         [ 2018, 10, 11, 712, 742, 1851, 1921 ],
                         [ 2018, 10, 12, 713, 744, 1849, 1920 ],
                         [ 2018, 10, 13, 715, 745, 1847, 1918 ],
                         [ 2018, 10, 14, 716, 747, 1845, 1916 ],
                         [ 2018, 10, 15, 717, 748, 1843, 1914 ],
                         [ 2018, 10, 16, 719, 749, 1842, 1912 ],
                         [ 2018, 10, 17, 720, 751, 1840, 1910 ],
                         [ 2018, 10, 18, 721, 752, 1838, 1909 ],
                         [ 2018, 10, 19, 723, 754, 1836, 1907 ],
                         [ 2018, 10, 20, 724, 755, 1834, 1905 ],
                         [ 2018, 10, 21, 725, 756, 1833, 1904 ],
                         [ 2018, 10, 22, 727, 758, 1831, 1902 ],
                         [ 2018, 10, 23, 728, 759, 1829, 1900 ],
                         [ 2018, 10, 24, 730, 801, 1827, 1859 ],
                         [ 2018, 10, 25, 731, 802, 1826, 1857 ],
                         [ 2018, 10, 26, 732, 804, 1824, 1855 ],
                         [ 2018, 10, 27, 734, 805, 1822, 1854 ],
                         [ 2018, 10, 28, 635, 707, 1721, 1752 ],
                         [ 2018, 10, 29, 637, 708, 1719, 1751 ],
                         [ 2018, 10, 30, 638, 710, 1718, 1749 ],
                         [ 2018, 10, 31, 639, 711, 1716, 1748 ],
                         [ 2018, 11, 1, 641, 713, 1715, 1746 ],
                         [ 2018, 11, 2, 642, 714, 1713, 1745 ],
                         [ 2018, 11, 3, 643, 715, 1712, 1743 ],
                         [ 2018, 11, 4, 645, 717, 1710, 1742 ],
                         [ 2018, 11, 5, 646, 718, 1709, 1741 ],
                         [ 2018, 11, 6, 648, 720, 1707, 1739 ],
                         [ 2018, 11, 7, 649, 721, 1706, 1738 ],
                         [ 2018, 11, 8, 650, 723, 1705, 1737 ],
                         [ 2018, 11, 9, 652, 724, 1703, 1736 ],
                         [ 2018, 11, 10, 653, 726, 1702, 1735 ],
                         [ 2018, 11, 11, 655, 727, 1701, 1733 ],
                         [ 2018, 11, 12, 656, 729, 1659, 1732 ],
                         [ 2018, 11, 13, 657, 730, 1658, 1731 ],
                         [ 2018, 11, 14, 659, 732, 1657, 1730 ],
                         [ 2018, 11, 15, 700, 733, 1656, 1729 ],
                         [ 2018, 11, 16, 701, 735, 1655, 1728 ],
                         [ 2018, 11, 17, 703, 736, 1654, 1727 ],
                         [ 2018, 11, 18, 704, 737, 1653, 1726 ],
                         [ 2018, 11, 19, 705, 739, 1652, 1725 ],
                         [ 2018, 11, 20, 707, 740, 1651, 1725 ],
                         [ 2018, 11, 21, 708, 742, 1650, 1724 ],
                         [ 2018, 11, 22, 709, 743, 1649, 1723 ],
                         [ 2018, 11, 23, 711, 744, 1648, 1722 ],
                         [ 2018, 11, 24, 712, 746, 1648, 1722 ],
                         [ 2018, 11, 25, 713, 747, 1647, 1721 ],
                         [ 2018, 11, 26, 714, 748, 1646, 1720 ],
                         [ 2018, 11, 27, 716, 750, 1646, 1720 ],
                         [ 2018, 11, 28, 717, 751, 1645, 1719 ],
                         [ 2018, 11, 29, 718, 752, 1644, 1719 ],
                         [ 2018, 11, 30, 719, 754, 1644, 1718 ],
                         [ 2018, 12, 1, 720, 755, 1643, 1718 ],
                         [ 2018, 12, 2, 721, 756, 1643, 1718 ],
                         [ 2018, 12, 3, 722, 757, 1643, 1717 ],
                         [ 2018, 12, 4, 723, 758, 1642, 1717 ],
                         [ 2018, 12, 5, 725, 759, 1642, 1717 ],
                         [ 2018, 12, 6, 726, 801, 1642, 1717 ],
                         [ 2018, 12, 7, 727, 802, 1642, 1717 ],
                         [ 2018, 12, 8, 728, 803, 1641, 1716 ],
                         [ 2018, 12, 9, 728, 804, 1641, 1716 ],
                         [ 2018, 12, 10, 729, 805, 1641, 1716 ],
                         [ 2018, 12, 11, 730, 806, 1641, 1716 ],
                         [ 2018, 12, 12, 731, 806, 1641, 1717 ],
                         [ 2018, 12, 13, 732, 807, 1641, 1717 ],
                         [ 2018, 12, 14, 733, 808, 1641, 1717 ],
                         [ 2018, 12, 15, 734, 809, 1642, 1717 ],
                         [ 2018, 12, 16, 734, 810, 1642, 1717 ],
                         [ 2018, 12, 17, 735, 810, 1642, 1718 ],
                         [ 2018, 12, 18, 736, 811, 1643, 1718 ],
                         [ 2018, 12, 19, 736, 812, 1643, 1718 ],
                         [ 2018, 12, 20, 737, 812, 1643, 1719 ],
                         [ 2018, 12, 21, 737, 813, 1644, 1719 ],
                         [ 2018, 12, 22, 738, 813, 1644, 1720 ],
                         [ 2018, 12, 23, 738, 814, 1645, 1720 ],
                         [ 2018, 12, 24, 739, 814, 1645, 1721 ],
                         [ 2018, 12, 25, 739, 815, 1646, 1721 ],
                         [ 2018, 12, 26, 739, 815, 1647, 1722 ],
                         [ 2018, 12, 27, 740, 815, 1647, 1723 ],
                         [ 2018, 12, 28, 740, 815, 1648, 1724 ],
                         [ 2018, 12, 29, 740, 816, 1649, 1724 ],
                         [ 2018, 12, 30, 740, 816, 1650, 1725 ],
                         [ 2018, 12, 31, 741, 816, 1651, 1726 ] ];

    // Sun Almanac computation object
    var oAlmanac = new SA_Almanac();
    oAlmanac.setLocation("CH/Bern", 46.9524055555556d, 7.43958333333333d, 0.0f);

    // Loop through reference data
    var aiError = [0, 0, 0, 0, 0, 0, 0];  // Time difference: error, 0, 1, 2, 3, 4, 5 minutes
    for(var i=0; i<ALMANAC_DATA.size(); i++) {
      var iReference_year = ALMANAC_DATA[i][0];
      var iReference_month = ALMANAC_DATA[i][1];
      var iReference_day = ALMANAC_DATA[i][2];
      var iReference_dawn = ALMANAC_DATA[i][3];
      var iReference_sunrise = ALMANAC_DATA[i][4];
      var iReference_sunset = ALMANAC_DATA[i][5];
      var iReference_dusk = ALMANAC_DATA[i][6];
      
      // Compute almanac data
      var iEpochDate = Gregorian.moment({ :year => iReference_year, :month => iReference_month, :day => iReference_day }).value();
      oAlmanac.compute(iEpochDate, null, true);
    
      // Unit tests
      var iDelta;
      var iReference_hour;
      var iReference_min;
      // ... civil dawn
      iReference_min = iReference_dawn % 100;
      iReference_hour = (iReference_dawn - iReference_min)/100;
      iDelta = SA_Tests.verifyTimeLT(_oLogger, oAlmanac.iEpochCivilDawn, iReference_year, iReference_month, iReference_day, iReference_hour, iReference_min);
      aiError[iDelta+1] += 1;
      // ... sunrise
      iReference_min = iReference_sunrise % 100;
      iReference_hour = (iReference_sunrise - iReference_min)/100;
      iDelta = SA_Tests.verifyTimeLT(_oLogger, oAlmanac.iEpochSunrise, iReference_year, iReference_month, iReference_day, iReference_hour, iReference_min);
      aiError[iDelta+1] += 1;
      // ... sunset
      iReference_min = iReference_sunset % 100;
      iReference_hour = (iReference_sunset - iReference_min)/100;
      iDelta = SA_Tests.verifyTimeLT(_oLogger, oAlmanac.iEpochSunset, iReference_year, iReference_month, iReference_day, iReference_hour, iReference_min);
      aiError[iDelta+1] += 1;
      // ... civil dusk
      iReference_min = iReference_dusk % 100;
      iReference_hour = (iReference_dusk - iReference_min)/100;
      iDelta = SA_Tests.verifyTimeLT(_oLogger, oAlmanac.iEpochCivilDusk, iReference_year, iReference_month, iReference_day, iReference_hour, iReference_min);
      aiError[iDelta+1] += 1;
    }

    // Statistics
    _oLogger.debug("STATISTICS");
    for(var i=0; i<=5; i++) {
      _oLogger.debug(Lang.format("Delta=$1$: $2$", [i, aiError[i+1]]));
    }
    if(aiError[0] > 0) {
      _oLogger.error(Lang.format("Delta>5: $1$", [aiError[0]]));
      return false;
    }
    return true;
  }

}
